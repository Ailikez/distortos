#
# file: Kconfig
#
# author: Copyright (C) 2015 Kamil Szczygiel http://www.distortec.com http://www.freddiechopin.info
#
# This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of the MPL was not
# distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/.
#
# date: 2015-09-18
#

#
# This file covers devices and their memories as described in following places:
# - DS8626 datasheet (STM32F405xx, STM32F407xx), Revision 5, 2015-03-04, devices listed on website at 2015-09-09;
#

choice
	prompt "STM32F4 chip"
	default CHIP_STM32F407VGT
	depends on CHIP_STM32F4
	help
		Select STM32F4 chip

config CHIP_STM32F405OEY
	bool "STM32F405OEY"
	select CHIP_STM32F40
	select CHIP_STM32F405
	select CHIP_STM32F405O
	select CHIP_STM32F405OE
	help
		STMicroelectronics STM32F405OEY chip

config CHIP_STM32F405OGY
	bool "STM32F405OGY"
	select CHIP_STM32F40
	select CHIP_STM32F405
	select CHIP_STM32F405O
	select CHIP_STM32F405OG
	help
		STMicroelectronics STM32F405OGY chip

config CHIP_STM32F405RGT
	bool "STM32F405RGT"
	select CHIP_STM32F40
	select CHIP_STM32F405
	select CHIP_STM32F405R
	select CHIP_STM32F405RG
	help
		STMicroelectronics STM32F405RGT chip

config CHIP_STM32F405VGT
	bool "STM32F405VGT"
	select CHIP_STM32F40
	select CHIP_STM32F405
	select CHIP_STM32F405V
	select CHIP_STM32F405VG
	help
		STMicroelectronics STM32F405VGT chip

config CHIP_STM32F405ZGT
	bool "STM32F405ZGT"
	select CHIP_STM32F40
	select CHIP_STM32F405
	select CHIP_STM32F405Z
	select CHIP_STM32F405ZG
	help
		STMicroelectronics STM32F405ZGT chip

config CHIP_STM32F407IEH
	bool "STM32F407IEH"
	select CHIP_STM32F40
	select CHIP_STM32F407
	select CHIP_STM32F407I
	select CHIP_STM32F407IE
	help
		STMicroelectronics STM32F407IEH chip

config CHIP_STM32F407IET
	bool "STM32F407IET"
	select CHIP_STM32F40
	select CHIP_STM32F407
	select CHIP_STM32F407I
	select CHIP_STM32F407IE
	help
		STMicroelectronics STM32F407IET chip

config CHIP_STM32F407IGH
	bool "STM32F407IGH"
	select CHIP_STM32F40
	select CHIP_STM32F407
	select CHIP_STM32F407I
	select CHIP_STM32F407IG
	help
		STMicroelectronics STM32F407IGH chip

config CHIP_STM32F407IGT
	bool "STM32F407IGT"
	select CHIP_STM32F40
	select CHIP_STM32F407
	select CHIP_STM32F407I
	select CHIP_STM32F407IG
	help
		STMicroelectronics STM32F407IGT chip

config CHIP_STM32F407VET
	bool "STM32F407VET"
	select CHIP_STM32F40
	select CHIP_STM32F407
	select CHIP_STM32F407V
	select CHIP_STM32F407VE
	help
		STMicroelectronics STM32F407VET chip

config CHIP_STM32F407VGT
	bool "STM32F407VGT"
	select CHIP_STM32F40
	select CHIP_STM32F407
	select CHIP_STM32F407V
	select CHIP_STM32F407VG
	help
		STMicroelectronics STM32F407VGT chip

config CHIP_STM32F407ZET
	bool "STM32F407ZET"
	select CHIP_STM32F40
	select CHIP_STM32F407
	select CHIP_STM32F407Z
	select CHIP_STM32F407ZE
	help
		STMicroelectronics STM32F407ZET chip

config CHIP_STM32F407ZGT
	bool "STM32F407ZGT"
	select CHIP_STM32F40
	select CHIP_STM32F407
	select CHIP_STM32F407Z
	select CHIP_STM32F407ZG
	help
		STMicroelectronics STM32F407ZGT chip

endchoice

comment "STM32F4 chip options"

config CHIP_STM32F4_VDD_MV
	int "Vdd supply voltage, mV"
	range 1800 3600
	default 3300
	help
		Vdd supply voltage of the chip, mV.

config CHIP_STM32F4_FLASH_PREFETCH_ENABLE
	bool "Enable flash prefetch"
	default y
	help
		Enable flash prefetch option in FLASH->ACR register. Early revisions of
		older STM32F4 devices don't support this feature. Enabling this feature
		may also increase noise of ADC. Check device errata sheet of selected
		chip to see whether it is affected by any of these issues.

menu "RCC configuration"

config CHIP_STM32F4_RCC_STANDARD_CLOCK_CONFIGURATION_ENABLE
	bool "Enable standard configuration of RCC clocks"
	default y
	help
		Enable standard configuration of RCC clocks.

if CHIP_STM32F4_RCC_STANDARD_CLOCK_CONFIGURATION_ENABLE

config CHIP_STM32F4_RCC_HSE_ENABLE
	bool "Enable HSE"
	default n
	help
		Enable HSE (crystal/ceramic resonator or external user clock).

if CHIP_STM32F4_RCC_HSE_ENABLE

config CHIP_STM32F4_RCC_HSE_CLOCK_BYPASS
	bool "HSE Clock Bypass"
	default n
	help
		Selects whether HSE generator is bypassed. If enabled, external user
		clock connected to OSC_IN must be used. Crystal or ceramic resonator
		connected to OSC_IN and OSC_OUT must be used otherwise.

config CHIP_STM32F4_RCC_HSE_HZ
	int "Frequency of HSE clock, Hz"
	range 1000000 50000000 if CHIP_STM32F4_RCC_HSE_CLOCK_BYPASS
	range 4000000 26000000
	default 8000000
	help
		Frequency of HSE clock, Hz. This can be:
		- "HSE Clock Bypass" disabled - crystal/ceramic resonator connected to
		OSC_IN and OSC_OUT [4MHz; 26MHz];
		- "HSE Clock Bypass" enabled - external user clock connected to OSC_IN
		[1MHz; 50MHz];

endif	# CHIP_STM32F4_RCC_HSE_ENABLE

config CHIP_STM32F4_RCC_PLL_ENABLE
	bool "Enable PLL"
	default y
	help
		Enable PLL.

if CHIP_STM32F4_RCC_PLL_ENABLE

choice
	prompt "PLL and PLLI2S source"
	default CHIP_STM32F4_RCC_PLLSRC_HSI
	help
		Select PLL and PLLI2S source.

config CHIP_STM32F4_RCC_PLLSRC_HSI
	bool "HSI"
	help
		Select HSI as PLL and PLLI2S source.

config CHIP_STM32F4_RCC_PLLSRC_HSE
	bool "HSE"
	depends on CHIP_STM32F4_RCC_HSE_ENABLE
	help
		Select HSE as PLL and PLLI2S source.

endchoice

config CHIP_STM32F4_RCC_PLLM
	int "PLLM value"
	range 2 63
	default 8 if CHIP_STM32F4_RCC_PLLSRC_HSE
	default 16
	help
		PLLM value for main PLL and audio PLLI2S. It is used to divide PLL
		input clock (PLLin) before it is fed to VCO. VCO input frequency
		(VCOin) must be in the range [1MHz; 2MHz], 2MHz is recommended to limit
		PLL jitter.

		VCOin = PLLin / PLLM

config CHIP_STM32F4_RCC_PLLN
	int "PLLN value"
	range 192 432
	default 336
	help
		PLLN value for main PLL. It is used to multiply VCO input frequency
		(VCOin). Resulting VCO output frequency (VCOout) must be in the range
		[192MHz; 432MHz].

		VCOout = VCOin * PLLN = PLLin / PLLM * PLLN

choice
	prompt "PLLP value"
	default CHIP_STM32F4_RCC_PLLP_DIV2
	help
		PLLP value for main PLL. It is used to divide VCO output frequency
		(VCOout). PLL output frequency (PLLout) must not exceed 168MHz.

		PLLout = VCOout / PLLP = PLLin / PLLM * PLLN / PLLP

config CHIP_STM32F4_RCC_PLLP_DIV2
	bool "2"
	help
		PLLP == 2

config CHIP_STM32F4_RCC_PLLP_DIV4
	bool "4"
	help
		PLLP == 4

config CHIP_STM32F4_RCC_PLLP_DIV6
	bool "6"
	help
		PLLP == 6

config CHIP_STM32F4_RCC_PLLP_DIV8
	bool "8"
	help
		PLLP == 8

endchoice

config CHIP_STM32F4_RCC_PLLQ
	int "PLLQ value"
	range 2 15
	default 7
	help
		PLLQ value for main PLL. It is used to divide VCO output frequency
		(VCOout) to produce clock for USB OTG FS, SDIO and RNG (PLLQout). USB
		OTG FS requires a 48MHz clock for correct operation, while SDIO and RNG
		need a frequency lower than or equal to 48MHz to work correctly.

		PLLQout = VCOout / PLLQ = PLLin / PLLM * PLLN / PLLQ

endif	# CHIP_STM32F4_RCC_PLL_ENABLE

choice
	prompt "System clock source"
	default CHIP_STM32F4_RCC_SYSCLK_PLL
	help
		Select system clock source.

config CHIP_STM32F4_RCC_SYSCLK_HSI
	bool "HSI"
	help
		HSI oscillator selected as system clock.

config CHIP_STM32F4_RCC_SYSCLK_HSE
	bool "HSE"
	depends on CHIP_STM32F4_RCC_HSE_ENABLE
	help
		HSE oscillator selected as system clock.

config CHIP_STM32F4_RCC_SYSCLK_PLL
	bool "PLL"
	depends on CHIP_STM32F4_RCC_PLL_ENABLE
	help
		Main PLL selected as system clock.

endchoice

choice
	prompt "AHB divider"
	default CHIP_STM32F4_RCC_AHB_DIV1
	help
		AHB clock division factor

		AHBclk = SYSclk / AHBdivider

config CHIP_STM32F4_RCC_AHB_DIV1
	bool "1"
	help
		System clock not divided

config CHIP_STM32F4_RCC_AHB_DIV2
	bool "2"
	help
		System clock divided by 2

config CHIP_STM32F4_RCC_AHB_DIV4
	bool "4"
	help
		System clock divided by 4

config CHIP_STM32F4_RCC_AHB_DIV8
	bool "8"
	help
		System clock divided by 8

config CHIP_STM32F4_RCC_AHB_DIV16
	bool "16"
	help
		System clock divided by 16

config CHIP_STM32F4_RCC_AHB_DIV64
	bool "64"
	help
		System clock divided by 64

config CHIP_STM32F4_RCC_AHB_DIV128
	bool "128"
	help
		System clock divided by 128

config CHIP_STM32F4_RCC_AHB_DIV256
	bool "256"
	help
		System clock divided by 256

config CHIP_STM32F4_RCC_AHB_DIV512
	bool "512"
	help
		System clock divided by 512

endchoice

choice
	prompt "APB1 (low speed) divider"
	default CHIP_STM32F4_RCC_APB1_DIV4
	help
		APB1 (low speed) clock division factor. APB1 clock must not exceed
		42MHz.

		APB1clk = AHBclk / APB1divider

config CHIP_STM32F4_RCC_APB1_DIV1
	bool "1"
	help
		AHB clock not divided

config CHIP_STM32F4_RCC_APB1_DIV2
	bool "2"
	help
		AHB clock divided by 2

config CHIP_STM32F4_RCC_APB1_DIV4
	bool "4"
	help
		AHB clock divided by 4

config CHIP_STM32F4_RCC_APB1_DIV8
	bool "8"
	help
		AHB clock divided by 8

config CHIP_STM32F4_RCC_APB1_DIV16
	bool "16"
	help
		AHB clock divided by 16

endchoice

choice
	prompt "APB2 (high speed) divider"
	default CHIP_STM32F4_RCC_APB2_DIV2
	help
		APB2 (high speed) clock division factor. APB2 clock must not exceed
		84MHz.

		APB2clk = AHBclk / APB2divider

config CHIP_STM32F4_RCC_APB2_DIV1
	bool "1"
	help
		AHB clock not divided

config CHIP_STM32F4_RCC_APB2_DIV2
	bool "2"
	help
		AHB clock divided by 2

config CHIP_STM32F4_RCC_APB2_DIV4
	bool "4"
	help
		AHB clock divided by 4

config CHIP_STM32F4_RCC_APB2_DIV8
	bool "8"
	help
		AHB clock divided by 8

config CHIP_STM32F4_RCC_APB2_DIV16
	bool "16"
	help
		AHB clock divided by 16

endchoice

endif	# CHIP_STM32F4_RCC_STANDARD_CLOCK_CONFIGURATION_ENABLE

if !CHIP_STM32F4_RCC_STANDARD_CLOCK_CONFIGURATION_ENABLE

config CHIP_STM32F4_RCC_AHB_HZ
	int "Frequency of AHB clock, Hz"
	range 1 180000000 if CHIP_STM32F42 || CHIP_STM32F43 || CHIP_STM32F44 || CHIP_STM32F47
	range 1 168000000 if CHIP_STM32F405 || CHIP_STM32F407 || CHIP_STM32F415 || CHIP_STM32F4
	range 1 100000000 if CHIP_STM32F411
	range 1 84000000
	default 16000000
	help
		Frequency of AHB clock, Hz. RCC must be configured by user to achieve
		that frequency.

endif	# !CHIP_STM32F4_RCC_STANDARD_CLOCK_CONFIGURATION_ENABLE

endmenu

config CHIP_STM32F40
	bool
	default n

config CHIP_STM32F405
	bool
	default n

config CHIP_STM32F405O
	bool
	default n

config CHIP_STM32F405OE
	bool
	default n

config CHIP_STM32F405OG
	bool
	default n

config CHIP_STM32F405R
	bool
	default n

config CHIP_STM32F405RG
	bool
	default n

config CHIP_STM32F405V
	bool
	default n

config CHIP_STM32F405VG
	bool
	default n

config CHIP_STM32F405Z
	bool
	default n

config CHIP_STM32F405ZG
	bool
	default n

config CHIP_STM32F407
	bool
	default n

config CHIP_STM32F407I
	bool
	default n

config CHIP_STM32F407IE
	bool
	default n

config CHIP_STM32F407IG
	bool
	default n

config CHIP_STM32F407V
	bool
	default n

config CHIP_STM32F407VE
	bool
	default n

config CHIP_STM32F407VG
	bool
	default n

config CHIP_STM32F407Z
	bool
	default n

config CHIP_STM32F407ZE
	bool
	default n

config CHIP_STM32F407ZG
	bool
	default n

config CHIP_STM32F4_BKPSRAM_SIZE
	int
	default 4096 if CHIP_STM32F405 || CHIP_STM32F407
	default 0

config CHIP_STM32F4_BKPSRAM_ADDRESS
	hex
	default 0x40024000
	depends on CHIP_STM32F4_BKPSRAM_SIZE != 0

config CHIP_STM32F4_CCM_SIZE
	int
	default 65536 if CHIP_STM32F405 || CHIP_STM32F407
	default 0

config CHIP_STM32F4_CCM_ADDRESS
	hex
	default 0x10000000
	depends on CHIP_STM32F4_CCM_SIZE != 0

config CHIP_STM32F4_FLASH_SIZE
	int
	default 524288 if CHIP_STM32F405OE || CHIP_STM32F407IE || CHIP_STM32F407VE || CHIP_STM32F407ZE
	default 1048576 if CHIP_STM32F405OG || CHIP_STM32F405RG || CHIP_STM32F405VG || CHIP_STM32F405ZG || \
		CHIP_STM32F407IG || CHIP_STM32F407VG || CHIP_STM32F407ZG
	default 0

config CHIP_STM32F4_FLASH_ADDRESS
	hex
	default 0x08000000
	depends on CHIP_STM32F4_FLASH_SIZE != 0

config CHIP_STM32F4_SRAM1_SIZE
	int
	default 114688 if CHIP_STM32F405 || CHIP_STM32F407
	default 0

config CHIP_STM32F4_SRAM1_ADDRESS
	hex
	default 0x20000000
	depends on CHIP_STM32F4_SRAM1_SIZE != 0

config CHIP_STM32F4_SRAM2_SIZE
	int
	default 16384 if CHIP_STM32F405 || CHIP_STM32F407
	default 0

config CHIP_STM32F4_SRAM2_ADDRESS
	hex
	default 0x2001C000
	depends on CHIP_STM32F4_SRAM2_SIZE != 0

config CHIP_STM32F4_SRAM3_SIZE
	int
	default 0

config CHIP_STM32F4_SRAM3_ADDRESS
	hex
	default 0x20020000
	depends on CHIP_STM32F4_SRAM3_SIZE != 0

config CHIP
	string
	default "STM32F405OEY" if CHIP_STM32F405OEY
	default "STM32F405OGY" if CHIP_STM32F405OGY
	default "STM32F405RGT" if CHIP_STM32F405RGT
	default "STM32F405VGT" if CHIP_STM32F405VGT
	default "STM32F405ZGT" if CHIP_STM32F405ZGT
	default "STM32F407IEH" if CHIP_STM32F407IEH
	default "STM32F407IET" if CHIP_STM32F407IET
	default "STM32F407IGH" if CHIP_STM32F407IGH
	default "STM32F407IGT" if CHIP_STM32F407IGT
	default "STM32F407VET" if CHIP_STM32F407VET
	default "STM32F407VGT" if CHIP_STM32F407VGT
	default "STM32F407ZET" if CHIP_STM32F407ZET
	default "STM32F407ZGT" if CHIP_STM32F407ZGT

config CHIP_INCLUDES
	string
	default "source/chip/STMicroelectronics/STM32F4/include external/CMSIS-STM32F4 external/CMSIS"
